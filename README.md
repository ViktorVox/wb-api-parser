# Тестовое задание: Парсер API (Laravel 11)

Бэкенд-сервис для фоновой синхронизации данных из внешнего REST API (Склады, Заказы, Продажи, Доходы) в локальную базу данных MySQL.

## Особенности реализации (Engineering Decisions)

1. **Обход жестких лимитов Swoole / WAF:**
   * В ходе дебага было выявлено, что сервер на Laravel Octane (Swoole) сбрасывает TCP-соединения (`cURL error 52`) и выдает `403 Forbidden` на стандартные запросы от `GuzzleHttp`.
   * **Решение:** Реализована полная маскировка запросов под HTTP-клиент (подмена `User-Agent`, `Accept-Encoding: gzip, deflate, br`, `Connection: keep-alive`). Парсинг работает стабильно.
2. **Идемпотентность данных (Безопасность при рестартах):**
   * Вместо слепого `insert` используется `updateOrCreate` с уникальными составными ключами (например, `income_id` + `barcode`). При случайном повторном запуске или наложении дат данные обновляются, а дубликаты не плодятся.
3. **Безопасность ключей:**
   * Токены доступа и URL вынесены в `.env`.
4. **Динамическая пагинация:**
   * Парсер автоматически забирает `last_page` из мета-данных ответа и обходит все страницы через цикл `do-while` до полного истощения пула данных.

## Стек технологий

* **PHP:** 8.3
* **Фреймворк:** Laravel 11
* **БД:** MySQL
* **Окружение:** Docker (Laravel Sail)

## Доступные консольные команды (Artisan)

Все скрипты парсинга реализованы в виде изолированных консольных команд, готовых для постановки в Cron (Task Scheduling):

```bash
# Синхронизация складов (за сегодня)
php artisan api:sync-stocks

# Синхронизация заказов (история с 10.02.2026 года)
php artisan api:sync-orders

# Синхронизация продаж (история с 10.02.2026 года)
php artisan api:sync-sales

# Синхронизация доходов/поставок (история с 10.02.2026 года)
php artisan api:sync-incomes
